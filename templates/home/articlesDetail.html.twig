{% extends 'base.html.twig' %}

{% block title %}{{ articles.title }}{% endblock %}

{% block body %}
    <div class="container">
        <div class="article-detail">
            <img src="{{ '../articles/'~articles.image }}" alt="{{ articles.title }}">
            <h1>{{ articles.title }}</h1>
            <div>{{ articles.content|raw }}</div>
        </div>

        {% if app.user %}
            <div class="mt-5">
                <h3>Ajouter un commentaire</h3>

                {{ form_start(form) }}

                {{ form_widget(form.title, {'attr': {'class': 'form-control-comments', 'placeholder': 'Titre'}}) }}
                {{ form_widget(form.content, {'attr': {'class': 'form-control-comments mt-3', 'placeholder': 'Votre commentaire'}}) }}

                <button class="btn btn-primary mt-3">Publier</button>

                {{ form_end(form) }}
            </div>
        {% else %}
            <div class="alert alert-info mt-4">
                Vous devez Ãªtre connectÃ© pour commenter.
            </div>
        {% endif %}


        <div class="comments-section mt-5">
            <h2>Commentaires ({{ articles.comments|length }})</h2>

            {% if articles.comments|length > 0 %}
                {% for comment in articles.comments %}
                    <div class="commentary d-flex align-items-start mb-4 p-3 border rounded">
                        <div class="me-3">
                            <img class="rounded-circle comments-pics" src="https://www.centre-social-la-seyne.com/wp-content/uploads/2025/03/blank-profile-picture-973460_960_720.webp" alt="Photo de profil">
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1">
                                {{ comment.title }} - <span class="text-muted">par {{ comment.author }}</span>
                            </h6>
                            <p class="mb-0"> {{ comment.content }} </p>
                            
                            {% if app.user and app.user.id != comment.author.id %}
                        <button class="btn-report mt-2" onclick="openReportModal({{ comment.id }})">
                          ðŸš© Signaler
                         </button>
                    {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p>Aucun commentaire pour le moment.</p>
            {% endif %}
        </div>
    </div>

    {# Modal de signalement #}
    <div id="reportModal" class="modal-report">
        <div class="modal-content-report">
            <span class="close-modal" onclick="closeReportModal()">&times;</span>
            <h2>ðŸš© Signaler ce commentaire</h2>
            <form id="reportForm" method="post">
                <input type="hidden" id="reportCommentId" name="comment_id">
                
                <div class="form-group">
                    <label for="reportReason">Raison du signalement :</label>
                    <select name="reason" id="reportReason" class="form-control" required>
                        <option value="">Choisir une raison...</option>
                        <option value="Contenu offensant">Contenu offensant</option>
                        <option value="Spam">Spam</option>
                        <option value="HarcÃ¨lement">HarcÃ¨lement</option>
                        <option value="Fausses informations">Fausses informations</option>
                        <option value="Hors sujet">Hors sujet</option>
                        <option value="Autre">Autre</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-primary mt-3">Envoyer le signalement</button>
            </form>
        </div>
    </div>

    <script>
    function openReportModal(commentId) {
        document.getElementById('reportModal').style.display = 'block';
        document.getElementById('reportCommentId').value = commentId;
        document.getElementById('reportForm').action = '/comment/' + commentId + '/report';
    }

    function closeReportModal() {
        document.getElementById('reportModal').style.display = 'none';
    }

    // Fermer la modal si on clique en dehors
    window.onclick = function(event) {
        const modal = document.getElementById('reportModal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
    </script>
{% endblock %}
